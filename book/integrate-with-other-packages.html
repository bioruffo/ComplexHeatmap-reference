<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 10 Integrate with other packages | ComplexHeatmap Complete Reference</title>
<meta name="author" content="Zuguang Gu">
<meta name="description" content="10.1 pheatmap pheatmap is a great R package for making heatmaps, inspiring a lot of other heatmap packages such as ComplexHeatmap. From version 2.5.2 of ComplexHeatmap, I implemented a new...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="Chapter 10 Integrate with other packages | ComplexHeatmap Complete Reference">
<meta property="og:type" content="book">
<meta property="og:url" content="https://jokergoo.github.io/ComplexHeatmap-reference/book/integrate-with-other-packages.html">
<meta property="og:image" content="https://jokergoo.github.io/ComplexHeatmap-reference/book/complexheatmap-cover.jpg">
<meta property="og:description" content="10.1 pheatmap pheatmap is a great R package for making heatmaps, inspiring a lot of other heatmap packages such as ComplexHeatmap. From version 2.5.2 of ComplexHeatmap, I implemented a new...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 10 Integrate with other packages | ComplexHeatmap Complete Reference">
<meta name="twitter:description" content="10.1 pheatmap pheatmap is a great R package for making heatmaps, inspiring a lot of other heatmap packages such as ComplexHeatmap. From version 2.5.2 of ComplexHeatmap, I implemented a new...">
<meta name="twitter:image" content="https://jokergoo.github.io/ComplexHeatmap-reference/book/complexheatmap-cover.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><style>
    #content {
    	font-size: 0.95rem;
    }
    </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">ComplexHeatmap Complete Reference</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="a-single-heatmap.html"><span class="header-section-number">2</span> A Single Heatmap</a></li>
<li><a class="" href="heatmap-annotations.html"><span class="header-section-number">3</span> Heatmap Annotations</a></li>
<li><a class="" href="a-list-of-heatmaps.html"><span class="header-section-number">4</span> A List of Heatmaps</a></li>
<li><a class="" href="legends.html"><span class="header-section-number">5</span> Legends</a></li>
<li><a class="" href="heatmap-decoration.html"><span class="header-section-number">6</span> Heatmap Decoration</a></li>
<li><a class="" href="oncoprint.html"><span class="header-section-number">7</span> OncoPrint</a></li>
<li><a class="" href="upset-plot.html"><span class="header-section-number">8</span> UpSet plot</a></li>
<li><a class="" href="interactive.html"><span class="header-section-number">9</span> Interactive ComplexHeatmap</a></li>
<li><a class="active" href="integrate-with-other-packages.html"><span class="header-section-number">10</span> Integrate with other packages</a></li>
<li><a class="" href="other-high-level-plots.html"><span class="header-section-number">11</span> Other High-level Plots</a></li>
<li><a class="" href="three-d-heatmap.html"><span class="header-section-number">12</span> Three-dimensional ComplexHeatmap</a></li>
<li><a class="" href="genome-level-heatmap.html"><span class="header-section-number">13</span> Genome-level heatmap</a></li>
<li><a class="" href="more-examples.html"><span class="header-section-number">14</span> More Examples</a></li>
<li><a class="" href="other-tricks.html"><span class="header-section-number">15</span> Other Tricks</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jokergoo/ComplexHeatmap">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="integrate-with-other-packages" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Integrate with other packages<a class="anchor" aria-label="anchor" href="#integrate-with-other-packages"><i class="fas fa-link"></i></a>
</h1>
<div id="pheatmap" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> pheatmap<a class="anchor" aria-label="anchor" href="#pheatmap"><i class="fas fa-link"></i></a>
</h2>
<p><strong>pheatmap</strong> is a great R package for making heatmaps, inspiring a lot of other
heatmap packages such as <strong>ComplexHeatmap</strong>. From version 2.5.2 of
<strong>ComplexHeatmap</strong>, I implemented a new <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">ComplexHeatmap::pheatmap()</a></code> function
which actually maps all the parameters in <code><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap::pheatmap()</a></code> to proper
parameters in <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">ComplexHeatmap::Heatmap()</a></code>, which means, it converts a pheatmap
to a complex heatmap. By doing this, the most significant improvement is now you
can add multiple pheatmaps and annotations (defined by
<code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/rowAnnotation.html">ComplexHeatmap::rowAnnotation()</a></code>).</p>
<p><strong><code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">ComplexHeatmap::pheatmap()</a></code> includes all arguments in <code><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap::pheatmap()</a></code>,
which means, you don’t need to do any adaptation on your pheatmap code, you just
rerun your pheatmap code and it will automatically and nicely convert to the
complex heatmap.</strong></p>
<p>Some arguments in <code><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap::pheatmap()</a></code> are disabled and ignored in this translation,
listed as follows:</p>
<ul>
<li><code>kmeans_k</code></li>
<li><code>filename</code></li>
<li><code>width</code></li>
<li><code>height</code></li>
<li><code>silent</code></li>
</ul>
<p>The usage of remaining arguments is <strong>exactly the same</strong> as in <code><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap::pheatmap()</a></code>.</p>
<p>In <code><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap::pheatmap()</a></code>, the <code>color</code> argument is specified with a long color vector,
e.g. :</p>
<div class="sourceCode" id="cb681"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pheatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap</a></span><span class="op">(</span><span class="va">mat</span>, 
    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">rev</a></span><span class="op">(</span><span class="fu">brewer.pal</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">7</span>, name <span class="op">=</span> <span class="st">"RdYlBu"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>You can use the same setting of <code>color</code> in <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">ComplexHeatmap::pheatmap()</a></code>, but you
can also simplify it as:</p>
<div class="sourceCode" id="cb682"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">pheatmap</a></span><span class="op">(</span><span class="va">mat</span>, 
    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">rev</a></span><span class="op">(</span><span class="fu">brewer.pal</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">7</span>, name <span class="op">=</span> <span class="st">"RdYlBu"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>The colors for individual values are automatically interpolated.</p>
<div id="examples" class="section level3" number="10.1.1">
<h3>
<span class="header-section-number">10.1.1</span> Examples<a class="anchor" aria-label="anchor" href="#examples"><i class="fas fa-link"></i></a>
</h3>
<p>First we load an example dataset which is from <a href="https://rdrr.io/cran/pheatmap/man/pheatmap.html#heading-6">the “Examples” section of
the documentation of <code>pheatmap::pheatmap()</code> function</a> .</p>
<div class="sourceCode" id="cb683"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/ComplexHeatmap">ComplexHeatmap</a></span><span class="op">)</span>
<span class="va">test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>, <span class="fl">20</span>, <span class="fl">10</span><span class="op">)</span>
<span class="va">test</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="va">test</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span>
<span class="va">test</span><span class="op">[</span><span class="fl">11</span><span class="op">:</span><span class="fl">20</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="va">test</span><span class="op">[</span><span class="fl">11</span><span class="op">:</span><span class="fl">20</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fl">2</span>
<span class="va">test</span><span class="op">[</span><span class="fl">15</span><span class="op">:</span><span class="fl">20</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="va">test</span><span class="op">[</span><span class="fl">15</span><span class="op">:</span><span class="fl">20</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fl">4</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">colnames</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="st">"Test"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">rownames</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="st">"Gene"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p>Calling <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">pheatmap()</a></code> (which is now actually <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">ComplexHeatmap::pheatmap()</a></code>) generates
a similar heatmap as by <code><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap::pheatmap()</a></code>.</p>
<div class="sourceCode" id="cb684"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">pheatmap</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span>  <span class="co"># this is ComplexHeatmap::pheatmap</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-4-1.png" width="384" style="display: block; margin: auto;"></div>
<p>Everything looks the same except the style of the heatmap legend. There are also
some other visual difference which you can find in the “Comparisons” section in this post.</p>
<p>The next one is an example for setting annotations (you should be familiar with
how to set these data frames and color list if you are a pheatmap user).</p>
<div class="sourceCode" id="cb685"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">annotation_col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    CellType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"CT1"</span>, <span class="st">"CT2"</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>, 
    Time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">rownames</a></span><span class="op">(</span><span class="va">annotation_col</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="st">"Test"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">annotation_row</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    GeneClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"Path1"</span>, <span class="st">"Path2"</span>, <span class="st">"Path3"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">rownames</a></span><span class="op">(</span><span class="va">annotation_row</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="st">"Gene"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">ann_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    Time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"firebrick"</span><span class="op">)</span>,
    CellType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span>CT1 <span class="op">=</span> <span class="st">"#1B9E77"</span>, CT2 <span class="op">=</span> <span class="st">"#D95F02"</span><span class="op">)</span>,
    GeneClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span>Path1 <span class="op">=</span> <span class="st">"#7570B3"</span>, Path2 <span class="op">=</span> <span class="st">"#E7298A"</span>, Path3 <span class="op">=</span> <span class="st">"#66A61E"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb686"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">pheatmap</a></span><span class="op">(</span><span class="va">test</span>, annotation_col <span class="op">=</span> <span class="va">annotation_col</span>, annotation_row <span class="op">=</span> <span class="va">annotation_row</span>, 
    annotation_colors <span class="op">=</span> <span class="va">ann_colors</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-6-1.png" width="480" style="display: block; margin: auto;"></div>
<p><code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">ComplexHeatmap::pheatmap()</a></code> returns a <code>Heatmap</code> object, so it can be added with
other heatmaps and annotations. Or in other words, you can add multiple pheatmaps
and annotations. Cool!</p>
<div class="sourceCode" id="cb687"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">pheatmap</a></span><span class="op">(</span><span class="va">test</span>, name <span class="op">=</span> <span class="st">"mat1"</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/rowAnnotation.html">rowAnnotation</a></span><span class="op">(</span>foo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_barplot.html">anno_barplot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html">nrow</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">pheatmap</a></span><span class="op">(</span><span class="va">test</span>, name <span class="op">=</span> <span class="st">"mat2"</span>, 
    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"navy"</span>, <span class="st">"white"</span>, <span class="st">"firebrick3"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span>
<span class="co"># or you can simply specify as</span>
<span class="co"># p3 = pheatmap(test, name = "mat2", col = c("navy", "white", "firebrick3"))</span>
<span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></div>
<p>Nevertheless, if you really want to add multiple pheatmaps, I still suggest you
to directly use the <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap()</a></code> function. You can find how to migrate from
<code><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap::pheatmap()</a></code> to <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">ComplexHeatmap::Heatmap()</a></code> in the next section.</p>
<p>In previous examples, the legend for row annotation is grouped with heatmap legend.
This can be modified by setting <code>legend_grouping</code> argument in <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw()</a></code> function:</p>
<div class="sourceCode" id="cb688"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">pheatmap</a></span><span class="op">(</span><span class="va">test</span>, annotation_col <span class="op">=</span> <span class="va">annotation_col</span>, annotation_row <span class="op">=</span> <span class="va">annotation_row</span>, 
    annotation_colors <span class="op">=</span> <span class="va">ann_colors</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span><span class="va">p</span>, legend_grouping <span class="op">=</span> <span class="st">"original"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto;"></div>
<p>One last thing is since <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">ComplexHeatmap::pheatmap()</a></code> returns a <code>Heatmap</code> object,
if <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">pheatmap()</a></code> is not called in an interactive environment, e.g. in an R script,
inside a function or in a <code>for</code> loop, you need to explicitly use <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw()</a></code> function:</p>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb689-1"><a href="integrate-with-other-packages.html#cb689-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(...) {</span>
<span id="cb689-2"><a href="integrate-with-other-packages.html#cb689-2" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> <span class="fu">pheatmap</span>(...)</span>
<span id="cb689-3"><a href="integrate-with-other-packages.html#cb689-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw</span>(p)</span>
<span id="cb689-4"><a href="integrate-with-other-packages.html#cb689-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="translation" class="section level3" number="10.1.2">
<h3>
<span class="header-section-number">10.1.2</span> Translation<a class="anchor" aria-label="anchor" href="#translation"><i class="fas fa-link"></i></a>
</h3>
<p>Following table lists how to map parameters in <code><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap::pheatmap()</a></code> to <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">ComplexHeatmap::Heatmap()</a></code>.</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="42%">
<col width="57%">
</colgroup>
<thead><tr class="header">
<th align="left">Arguments in <code><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap::pheatmap()</a></code>
</th>
<th align="left">Identical settings/arguments in <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">ComplexHeatmap::Heatmap()</a></code>
</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>mat</code></td>
<td align="left"><code>matrix</code></td>
</tr>
<tr class="even">
<td align="left"><code>color</code></td>
<td align="left">Users can specify a color mapping function by <code><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html">circlize::colorRamp2()</a></code>, or provide a vector of colors on which colors for individual values are linearly interpolated.</td>
</tr>
<tr class="odd">
<td align="left"><code>kmeans_k</code></td>
<td align="left">No corresponding parameter because it changes the matrix for heatmap.</td>
</tr>
<tr class="even">
<td align="left"><code>breaks</code></td>
<td align="left">It should be specified in the color mapping function.</td>
</tr>
<tr class="odd">
<td align="left"><code>border_color</code></td>
<td align="left">
<code>rect_gp = gpar(col = border_color)</code>. In the annotations, it is <code>HeatmapAnnotation(..., gp = gpar(col = border_color))</code>.</td>
</tr>
<tr class="even">
<td align="left"><code>cellwidth</code></td>
<td align="left"><code>width = ncol(mat)*unit(cellwidth, "pt")</code></td>
</tr>
<tr class="odd">
<td align="left"><code>cellheight</code></td>
<td align="left"><code>height = nrow(mat)*unit(cellheight, "pt")</code></td>
</tr>
<tr class="even">
<td align="left"><code>scale</code></td>
<td align="left">Users should simply apply <code><a href="https://rdrr.io/r/base/scale.html">scale()</a></code> on the matrix before sending to <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap()</a></code>.</td>
</tr>
<tr class="odd">
<td align="left"><code>cluster_rows</code></td>
<td align="left"><code>cluster_rows</code></td>
</tr>
<tr class="even">
<td align="left"><code>cluster_cols</code></td>
<td align="left"><code>cluster_columns</code></td>
</tr>
<tr class="odd">
<td align="left"><code>clustering_distance_rows</code></td>
<td align="left">
<code>clustering_distance_rows</code>. The value <code>correlation</code> should be changed to <code>pearson</code>.</td>
</tr>
<tr class="even">
<td align="left"><code>clustering_distance_cols</code></td>
<td align="left">
<code>clustering_distance_columns</code>, The value <code>correlation</code> should be changed to <code>pearson</code>.</td>
</tr>
<tr class="odd">
<td align="left"><code>clustering_method</code></td>
<td align="left">
<code>clustering_method_rows</code>/<code>clustering_method_columns</code>
</td>
</tr>
<tr class="even">
<td align="left"><code>clustering_callback</code></td>
<td align="left">The processing on the dendrogram should be applied before sending to <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap()</a></code>.</td>
</tr>
<tr class="odd">
<td align="left"><code>cutree_rows</code></td>
<td align="left">
<code>row_split</code> and row clustering should be applied.</td>
</tr>
<tr class="even">
<td align="left"><code>cutree_cols</code></td>
<td align="left">
<code>column_split</code> and column clustering should be applied.</td>
</tr>
<tr class="odd">
<td align="left"><code>treeheight_row</code></td>
<td align="left"><code>row_dend_width = unit(treeheight_row, "pt")</code></td>
</tr>
<tr class="even">
<td align="left"><code>treeheight_col</code></td>
<td align="left"><code>column_dend_height = unit(treeheight_col, "pt")</code></td>
</tr>
<tr class="odd">
<td align="left"><code>legend</code></td>
<td align="left"><code>show_heatmap_legend</code></td>
</tr>
<tr class="even">
<td align="left"><code>legend_breaks</code></td>
<td align="left"><code>heatmap_legend_param = list(at = legend_breaks)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>legend_labels</code></td>
<td align="left"><code>heatmap_legend_param = list(labels = legend_labels)</code></td>
</tr>
<tr class="even">
<td align="left"><code>annotation_row</code></td>
<td align="left"><code>left_annotatioin = rowAnnotation(df = annotation_row)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>annotation_col</code></td>
<td align="left"><code>top_annotation = HeatmapAnnotation(df = annotation_col)</code></td>
</tr>
<tr class="even">
<td align="left"><code>annotation</code></td>
<td align="left">Not supported.</td>
</tr>
<tr class="odd">
<td align="left"><code>annotation_colors</code></td>
<td align="left">
<code>col</code> argument in <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/HeatmapAnnotation.html">HeatmapAnnotation()</a></code>/<code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/rowAnnotation.html">rowAnnotation()</a></code>.</td>
</tr>
<tr class="even">
<td align="left"><code>annotation_legend</code></td>
<td align="left">
<code>show_legend</code> argument in <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/HeatmapAnnotation.html">HeatmapAnnotation()</a></code>/<code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/rowAnnotation.html">rowAnnotation()</a></code>.</td>
</tr>
<tr class="odd">
<td align="left"><code>annotation_names_row</code></td>
<td align="left">
<code>show_annotation_name</code> in <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/rowAnnotation.html">rowAnnotation()</a></code>.</td>
</tr>
<tr class="even">
<td align="left"><code>annotation_names_col</code></td>
<td align="left">
<code>show_annotation_name</code> in <code>HeatmaoAnnotation()</code>.</td>
</tr>
<tr class="odd">
<td align="left"><code>drop_levels</code></td>
<td align="left">Unused levels are all dropped.</td>
</tr>
<tr class="even">
<td align="left"><code>show_rownames</code></td>
<td align="left"><code>show_row_names</code></td>
</tr>
<tr class="odd">
<td align="left"><code>show_colnames</code></td>
<td align="left"><code>show_column_names</code></td>
</tr>
<tr class="even">
<td align="left"><code>main</code></td>
<td align="left"><code>column_title</code></td>
</tr>
<tr class="odd">
<td align="left"><code>fontsize</code></td>
<td align="left">
<code>gpar(fontsize = fontsize)</code> in corresponding heatmap components.</td>
</tr>
<tr class="even">
<td align="left"><code>fontsize_row</code></td>
<td align="left"><code>row_names_gp = gpar(fontsize = fontsize_row)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>fontsize_col</code></td>
<td align="left"><code>column_names_gp = gpar(fontsize = fontsize_col)</code></td>
</tr>
<tr class="even">
<td align="left"><code>angle_col</code></td>
<td align="left">
<code>column_names_rot</code>. The rotation of row annotation names are not supported.</td>
</tr>
<tr class="odd">
<td align="left"><code>display_numbers</code></td>
<td align="left">Users should set a proper <code>cell_fun</code> or <code>layer_fun</code> (vectorized and faster version of <code>cell_fun</code>). E.g. if <code>display_numbers</code> is <code>TRUE</code>, <code>layer_fun</code> can be set as <code>function(j, i, x, y, w, h, fill) { grid.text(sprintf(number_format, pindex(mat, i, j)), x = x, y = y, gp = gpar(col = number_color, fontsize = fontsize_number)) }</code>. If <code>display_numbers</code> is a matrix, replace <code>mat</code> to <code>display_numbers</code> in the <code>layer_fun</code>.</td>
</tr>
<tr class="even">
<td align="left"><code>number_format</code></td>
<td align="left">See above.</td>
</tr>
<tr class="odd">
<td align="left"><code>number_color</code></td>
<td align="left">See above.</td>
</tr>
<tr class="even">
<td align="left"><code>fontsize_number</code></td>
<td align="left">See above.</td>
</tr>
<tr class="odd">
<td align="left"><code>gaps_row</code></td>
<td align="left">Users should construct a “splitting variable” and send to <code>row_split</code>. E.g. <code>slices = diff(c(0, gaps_row, nrow(mat))); rep(seq_along(slices), times = slices)</code>.</td>
</tr>
<tr class="even">
<td align="left"><code>gaps_col</code></td>
<td align="left">Users should construct a “splitting variable” and send to <code>column_split</code>.</td>
</tr>
<tr class="odd">
<td align="left"><code>labels_row</code></td>
<td align="left"><code>row_labels</code></td>
</tr>
<tr class="even">
<td align="left"><code>labels_col</code></td>
<td align="left"><code>column_labels</code></td>
</tr>
<tr class="odd">
<td align="left"><code>filename</code></td>
<td align="left">No corresponding setting in <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap()</a></code>. Users need to explicitly use e.g. <code>pdf</code>().</td>
</tr>
<tr class="even">
<td align="left"><code>width</code></td>
<td align="left">No corresponding setting in <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap()</a></code>.</td>
</tr>
<tr class="odd">
<td align="left"><code>height</code></td>
<td align="left">No corresponding setting in <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap()</a></code>.</td>
</tr>
<tr class="even">
<td align="left"><code>silent</code></td>
<td align="left">No corresponding setting in <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap()</a></code>.</td>
</tr>
<tr class="odd">
<td align="left"><code>na_col</code></td>
<td align="left"><code>na_col</code></td>
</tr>
</tbody>
</table></div>
</div>
<div id="comparisons" class="section level3" number="10.1.3">
<h3>
<span class="header-section-number">10.1.3</span> Comparisons<a class="anchor" aria-label="anchor" href="#comparisons"><i class="fas fa-link"></i></a>
</h3>
<p>I ran all the example code in <a href="https://rdrr.io/cran/pheatmap/man/pheatmap.html#heading-6">the “Examples” section of the documentation of
<code>pheatmap::pheatmap()</code> function</a> .
I also implemented a wrapper function <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">ComplexHeatmap::compare_pheatmap()</a></code> which basically uses the same
set of arguments for <code><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap::pheatmap()</a></code> and <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/pheatmap.html">ComplexHeatmap::pheatmap()</a></code> and
draws two heatmaps, so that you can directly see the similarity and difference
of the two heatmap implementations.</p>
<div class="sourceCode" id="cb690"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-11-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb691"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, scale <span class="op">=</span> <span class="st">"row"</span>, clustering_distance_rows <span class="op">=</span> <span class="st">"correlation"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-12-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb692"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, 
    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"navy"</span>, <span class="st">"white"</span>, <span class="st">"firebrick3"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-13-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb693"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, cluster_row <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-14-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb694"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-15-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb695"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, display_numbers <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-16-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb696"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, display_numbers <span class="op">=</span> <span class="cn">TRUE</span>, number_format <span class="op">=</span> <span class="st">"%.1e"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-17-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb697"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, 
    display_numbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">test</span> <span class="op">&gt;</span> <span class="fl">5</span>, <span class="st">"*"</span>, <span class="st">""</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html">nrow</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-18-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb698"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, cluster_row <span class="op">=</span> <span class="cn">FALSE</span>, legend_breaks <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, 
    legend_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1e-4"</span>, <span class="st">"1e-3"</span>, <span class="st">"1e-2"</span>, <span class="st">"1e-1"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-19-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb699"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, cellwidth <span class="op">=</span> <span class="fl">15</span>, cellheight <span class="op">=</span> <span class="fl">12</span>, main <span class="op">=</span> <span class="st">"Example heatmap"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-20-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb700"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">annotation_col</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    CellType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"CT1"</span>, <span class="st">"CT2"</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>, 
    Time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">rownames</a></span><span class="op">(</span><span class="va">annotation_col</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="st">"Test"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">annotation_row</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    GeneClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"Path1"</span>, <span class="st">"Path2"</span>, <span class="st">"Path3"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">rownames</a></span><span class="op">(</span><span class="va">annotation_row</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="st">"Gene"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, annotation_col <span class="op">=</span> <span class="va">annotation_col</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-21-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb701"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, annotation_col <span class="op">=</span> <span class="va">annotation_col</span>, annotation_legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-22-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb702"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, annotation_col <span class="op">=</span> <span class="va">annotation_col</span>, 
    annotation_row <span class="op">=</span> <span class="va">annotation_row</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-23-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb703"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, annotation_col <span class="op">=</span> <span class="va">annotation_col</span>, 
    annotation_row <span class="op">=</span> <span class="va">annotation_row</span>, angle_col <span class="op">=</span> <span class="st">"45"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-24-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb704"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, annotation_col <span class="op">=</span> <span class="va">annotation_col</span>, angle_col <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-25-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb705"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ann_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    Time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"firebrick"</span><span class="op">)</span>,
    CellType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span>CT1 <span class="op">=</span> <span class="st">"#1B9E77"</span>, CT2 <span class="op">=</span> <span class="st">"#D95F02"</span><span class="op">)</span>,
    GeneClass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span>Path1 <span class="op">=</span> <span class="st">"#7570B3"</span>, Path2 <span class="op">=</span> <span class="st">"#E7298A"</span>, Path3 <span class="op">=</span> <span class="st">"#66A61E"</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, annotation_col <span class="op">=</span> <span class="va">annotation_col</span>, 
    annotation_colors <span class="op">=</span> <span class="va">ann_colors</span>, main <span class="op">=</span> <span class="st">"Title"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-26-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb706"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, annotation_col <span class="op">=</span> <span class="va">annotation_col</span>, 
    annotation_row <span class="op">=</span> <span class="va">annotation_row</span>, annotation_colors <span class="op">=</span> <span class="va">ann_colors</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-27-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb707"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, annotation_col <span class="op">=</span> <span class="va">annotation_col</span>, 
    annotation_colors <span class="op">=</span> <span class="va">ann_colors</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-28-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb708"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, annotation_col <span class="op">=</span> <span class="va">annotation_col</span>, cluster_rows <span class="op">=</span> <span class="cn">FALSE</span>, 
    gaps_row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">14</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-29-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb709"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, annotation_col <span class="op">=</span> <span class="va">annotation_col</span>, cluster_rows <span class="op">=</span> <span class="cn">FALSE</span>, 
    gaps_row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">14</span><span class="op">)</span>, cutree_col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-30-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb710"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">labels_row</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, 
    <span class="st">""</span>, <span class="st">""</span>, <span class="st">"Il10"</span>, <span class="st">"Il15"</span>, <span class="st">"Il1b"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, annotation_col <span class="op">=</span> <span class="va">annotation_col</span>, labels_row <span class="op">=</span> <span class="va">labels_row</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-31-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb711"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">drows</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">test</span>, method <span class="op">=</span> <span class="st">"minkowski"</span><span class="op">)</span>
<span class="va">dcols</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/t.html">t</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"minkowski"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, clustering_distance_rows <span class="op">=</span> <span class="va">drows</span>, 
    clustering_distance_cols <span class="op">=</span> <span class="va">dcols</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-32-1.png" width="768" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb712"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/evanbiederstedt/dendsort">dendsort</a></span><span class="op">)</span>
<span class="va">callback</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">hc</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/pkg/dendsort/man/dendsort.html">dendsort</a></span><span class="op">(</span><span class="va">hc</span><span class="op">)</span><span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/compare_pheatmap.html">compare_pheatmap</a></span><span class="op">(</span><span class="va">test</span>, clustering_callback <span class="op">=</span> <span class="va">callback</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-33-1.png" width="768" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="cowplot" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> cowplot<a class="anchor" aria-label="anchor" href="#cowplot"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://cran.r-project.org/web/packages/cowplot/index.html">The <strong>cowplot</strong> package</a> is used
to combine multiple plots into a single figure. In most cases,
<strong>ComplexHeatmap</strong> works perfectly with <strong>cowplot</strong>, but there are some cases that need
special attention.</p>
<p>Also there are some other packages that combine multiple plots, such
as <a href="https://cran.r-project.org/web/packages/multipanelfigure/index.html"><strong>multipanelfigure</strong></a>,
but I think the mechanism behind is the same.</p>
<p>Following functionalities in <strong>ComplexHeatmap</strong> cause problems with using <strong>cowplot</strong>.</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_zoom.html">anno_zoom()</a></code>/<code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_link.html">anno_link()</a></code>: The adjusted positions by these two functions rely on the size of the graphics
device.</li>
<li>
<code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_mark.html">anno_mark()</a></code>: The same reason as <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_zoom.html">anno_zoom()</a></code>. The adjusted positions also rely on the device size.</li>
<li>
<a href="https://jokergoo.github.io/ComplexHeatmap-reference/book/legends.html#heatmap-and-annotation-legends">When there are too many legends, the legends will be wrapped into multiple columns</a>. The calculation
of the legend positions rely on the device size.</li>
</ol>
<p>In following I demonstrate a case with using the <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_zoom.html">anno_zoom()</a></code>. Here the
example is from <a href="https://github.com/jokergoo/simplifyEnrichment">the <strong>simplifyEnrichment</strong>
package</a> and the plot shows a
GO similarity heatmap with word cloud annotation showing the major biological
functions in each group.</p>
<p>You don’t need to really understand the following code. The <code><a href="https://rdrr.io/pkg/simplifyEnrichment/man/ht_clusters.html">ht_clusters()</a></code>
function basically draws a heatmap with <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap()</a></code> and add the word cloud
annotation by <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_zoom.html">anno_zoom()</a></code>.</p>
<div class="sourceCode" id="cb713"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/simplifyEnrichment">simplifyEnrichment</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">go_id</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/simplifyEnrichment/man/random_GO.html">random_GO</a></span><span class="op">(</span><span class="fl">500</span><span class="op">)</span>
<span class="va">mat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/simplifyEnrichment/man/GO_similarity.html">GO_similarity</a></span><span class="op">(</span><span class="va">go_id</span><span class="op">)</span>
<span class="va">cl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/simplifyEnrichment/man/binary_cut.html">binary_cut</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/simplifyEnrichment/man/ht_clusters.html">ht_clusters</a></span><span class="op">(</span><span class="va">mat</span>, <span class="va">cl</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-34-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Next we put this heatmap as a sub-figure with <strong>cowplot</strong>. To integrate with
<strong>cowplot</strong>, the heatmap should be captured by <code><a href="https://rdrr.io/r/grid/grid.grab.html">grid::grid.grabExpr()</a></code> as a complex
<code>grob</code> object. Note here you need to use <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw()</a></code> function to draw the heatmap
explicitly.</p>
<div class="sourceCode" id="cb714"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.rect.html">rectGrob</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span>, height <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.grab.html">grid.grabExpr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/simplifyEnrichment/man/ht_clusters.html">ht_clusters</a></span><span class="op">(</span><span class="va">mat</span>, <span class="va">cl</span><span class="op">)</span><span class="op">)</span>
<span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.rect.html">rectGrob</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span>, height <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span>

<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, 
    <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p2</span>, <span class="va">p3</span>, nrow <span class="op">=</span> <span class="fl">2</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, 
    nrow <span class="op">=</span> <span class="fl">1</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">9</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-35-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Woooo! The word cloud annotation is badly aligned.</p>
<p>There are some details that should be noted for <code><a href="https://rdrr.io/r/grid/grid.grab.html">grid.grabExpr()</a></code> function. It actually
opens an invisible graphics device (by <code>pdf(NULL)</code>) with a default size 7x7 inches. Thus,
for this line:</p>
<div class="sourceCode" id="cb715"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.grab.html">grid.grabExpr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/simplifyEnrichment/man/ht_clusters.html">ht_clusters</a></span><span class="op">(</span><span class="va">mat</span>, <span class="va">cl</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The word cloud annotation in <code>p2</code> is actually calculated in a region of 7x7
inches, and when it is written back to the figure by <code><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid()</a></code>, the space
for <code>p2</code> changes, that is why the word cloud annotation is wrongly aligned.</p>
<p>On the other hand, if “a simple heatmap” is captured by <code><a href="https://rdrr.io/r/grid/grid.grab.html">grid.grabExpr()</a></code>, <em>e.g.</em>:</p>
<div class="sourceCode" id="cb716"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.grab.html">grid.grabExpr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>when <code>p2</code> is put back, everything will work fine because now all the heatmap
elements are not dependent on the device size and the positions will be
automatically adjusted to the new space.</p>
<p>This effect can also be observed by plotting the heatmap in the interactive
graphics device and resizing the window by dragging it.</p>
<p>The solution is rather simple. Since the reason for this inconsistency is the
different space between where it is captured and where it is drawn, we only
need to capture the heatmap under the device with the same size as where it is
going to be put.</p>
<p>As in the layout which we set in the <code><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid()</a></code> function, the heatmap occupies
9/10 width and 4/5 height of the figure. So, the width and height of the space
for the heatmap is calculated as follows and assigned to the <code>width</code> and
<code>height</code> arguments in <code><a href="https://rdrr.io/r/grid/grid.grab.html">grid.grabExpr()</a></code>.</p>
<div class="sourceCode" id="cb717"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.convert.html">convertWidth</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">9</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span>, <span class="st">"inch"</span>, valueOnly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">h</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.convert.html">convertHeight</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">4</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span>, <span class="st">"inch"</span>, valueOnly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.grab.html">grid.grabExpr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/simplifyEnrichment/man/ht_clusters.html">ht_clusters</a></span><span class="op">(</span><span class="va">mat</span>, <span class="va">cl</span><span class="op">)</span>, width <span class="op">=</span> <span class="va">w</span>, height <span class="op">=</span> <span class="va">h</span><span class="op">)</span>

<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, 
    <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p2</span>, <span class="va">p3</span>, nrow <span class="op">=</span> <span class="fl">2</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, 
    nrow <span class="op">=</span> <span class="fl">1</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">9</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-38-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Now everthing is back to normal!</p>
</div>
<div id="gridtext" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> gridtext<a class="anchor" aria-label="anchor" href="#gridtext"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://github.com/wilkelab/gridtext">The <strong>gridtext</strong> package</a> provides a nice and easy way
for rendering text under the <strong>grid</strong> system. From version 2.3.3 of <strong>ComplexHeatmap</strong>, text-related
elements can be rendered by <strong>gridtext</strong>.</p>
<p>For all text-related elements, the text needs to be wrapped by <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/gt_render.html">gt_render()</a></code> function, which marks
the text and adds related parameters that are going to be processed by <strong>gridtext</strong>.</p>
<p>Currently <strong>ComplexHeatmap</strong> supports <code><a href="https://wilkelab.org/gridtext/reference/richtext_grob.html">gridtext::richtext_grob()</a></code>, so some of the parameters for
<code>richtext_grob()</code> can be passed via <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/gt_render.html">gt_render()</a></code>.</p>
<div class="sourceCode" id="cb718"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/gt_render.html">gt_render</a></span><span class="op">(</span><span class="st">"foo"</span>, r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"pt"</span><span class="op">)</span>, padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"pt"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "foo"
## attr(,"class")
## [1] "gridtext"
## attr(,"param")
## attr(,"param")$r
## [1] 2points
## 
## attr(,"param")$padding
## [1] 2points 2points 2points 2points</code></pre>
<p>For each heatmap element, e.g. column title, graphic parameters can be set by the companion argument,
e.g. <code>column_title_gp</code>. To make it simpler, all graphic parameters set by <code>box_gp</code> are merged with <code>*_gp</code>
by adding <code>box_</code> prefix, e.g.:</p>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb720-1"><a href="integrate-with-other-packages.html#cb720-1" aria-hidden="true" tabindex="-1"></a>..., column_title <span class="ot">=</span> <span class="fu">gt_render</span>(<span class="st">"foo"</span>), column_title_gp <span class="ot">=</span> <span class="fu">gpar</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">box_fill =</span> <span class="st">"blue"</span>), ...</span></code></pre></div>
<p>Graphic parameters can also be specified inside <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/gt_render.html">gt_render()</a></code>. Following is the same as the one above:</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb721-1"><a href="integrate-with-other-packages.html#cb721-1" aria-hidden="true" tabindex="-1"></a>..., column_title <span class="ot">=</span> <span class="fu">gt_render</span>(<span class="st">"foo"</span>, <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">box_fill =</span> <span class="st">"blue"</span>)), ...</span></code></pre></div>
<div id="gridtext-title" class="section level3" number="10.3.1">
<h3>
<span class="header-section-number">10.3.1</span> Titles<a class="anchor" aria-label="anchor" href="#gridtext-title"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb722"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">mat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">rownames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">mat</span>, 
    column_title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/gt_render.html">gt_render</a></span><span class="op">(</span><span class="st">"Some &lt;span style='color:blue'&gt;blue text **in bold.**&lt;/span&gt;&lt;br&gt;And *italics text.*&lt;br&gt;And some &lt;span style='font-size:18pt; color:black'&gt;large&lt;/span&gt; text."</span>, 
        r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"pt"</span><span class="op">)</span>, 
        padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"pt"</span><span class="op">)</span><span class="op">)</span>,
    column_title_gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>box_fill <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-42-1.png" width="480" style="display: block; margin: auto;"></div>
<p>If heatmap is split:</p>
<div class="sourceCode" id="cb723"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">mat</span>, 
    row_km <span class="op">=</span> <span class="fl">2</span>, 
    row_title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/gt_render.html">gt_render</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"**title1**"</span>, <span class="st">"_title2_"</span><span class="op">)</span><span class="op">)</span>, 
    row_title_gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>box_fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"yellow"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-43-1.png" width="480" style="display: block; margin: auto;"></div>
</div>
<div id="gridtext-dimnames" class="section level3" number="10.3.2">
<h3>
<span class="header-section-number">10.3.2</span> Row/column names<a class="anchor" aria-label="anchor" href="#gridtext-dimnames"><i class="fas fa-link"></i></a>
</h3>
<p>Rendered row/column names should be explicitly specified by <code>row_labels</code>/<code>column_labels</code></p>
<div class="sourceCode" id="cb724"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">mat</span>, 
    row_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/gt_render.html">gt_render</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span>, <span class="st">"pt"</span><span class="op">)</span><span class="op">)</span>,
    row_names_gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>box_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-44-1.png" width="480" style="display: block; margin: auto;"></div>
</div>
<div id="gridtext-annotations" class="section level3" number="10.3.3">
<h3>
<span class="header-section-number">10.3.3</span> Annotation labels<a class="anchor" aria-label="anchor" href="#gridtext-annotations"><i class="fas fa-link"></i></a>
</h3>
<p><code>annotation_label</code> argument should be as rendered text.</p>
<div class="sourceCode" id="cb725"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ha</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/HeatmapAnnotation.html">HeatmapAnnotation</a></span><span class="op">(</span>foo <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,
    annotation_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/gt_render.html">gt_render</a></span><span class="op">(</span><span class="st">"**Annotation** _one_"</span>,
        gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>box_col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span>,
    show_legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">mat</span>, top_annotation <span class="op">=</span> <span class="va">ha</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-45-1.png" width="480" style="display: block; margin: auto;"></div>
</div>
<div id="gridtext-anno-text" class="section level3" number="10.3.4">
<h3>
<span class="header-section-number">10.3.4</span> Text annotation<a class="anchor" aria-label="anchor" href="#gridtext-anno-text"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb726"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/rowAnnotation.html">rowAnnotation</a></span><span class="op">(</span>
    foo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_text.html">anno_text</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/gt_render.html">gt_render</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">sapply</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="va">strrep</span>, <span class="fl">10</span><span class="op">)</span>, align_widths <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, 
                    gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>box_col <span class="op">=</span> <span class="st">"blue"</span>, box_lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, 
                    just <span class="op">=</span> <span class="st">"right"</span>, 
                    location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span>
    <span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-46-1.png" width="672" style="display: block; margin: auto;"></div>
</div>
<div id="gridtext-legends" class="section level3" number="10.3.5">
<h3>
<span class="header-section-number">10.3.5</span> Legend<a class="anchor" aria-label="anchor" href="#gridtext-legends"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb727"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">mat</span>, 
    heatmap_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/gt_render.html">gt_render</a></span><span class="op">(</span><span class="st">"&lt;span style='color:orange'&gt;**Legend title**&lt;/span&gt;"</span><span class="op">)</span>, 
        title_gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>box_fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,
        at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>, 
        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/gt_render.html">gt_render</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"*negative* three"</span>, <span class="st">"zero"</span>, <span class="st">"*positive* three"</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10-integrate-with-other-packages_files/figure-html/unnamed-chunk-47-1.png" width="480" style="display: block; margin: auto;"></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="interactive.html"><span class="header-section-number">9</span> Interactive ComplexHeatmap</a></div>
<div class="next"><a href="other-high-level-plots.html"><span class="header-section-number">11</span> Other High-level Plots</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#integrate-with-other-packages"><span class="header-section-number">10</span> Integrate with other packages</a></li>
<li>
<a class="nav-link" href="#pheatmap"><span class="header-section-number">10.1</span> pheatmap</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#examples"><span class="header-section-number">10.1.1</span> Examples</a></li>
<li><a class="nav-link" href="#translation"><span class="header-section-number">10.1.2</span> Translation</a></li>
<li><a class="nav-link" href="#comparisons"><span class="header-section-number">10.1.3</span> Comparisons</a></li>
</ul>
</li>
<li><a class="nav-link" href="#cowplot"><span class="header-section-number">10.2</span> cowplot</a></li>
<li>
<a class="nav-link" href="#gridtext"><span class="header-section-number">10.3</span> gridtext</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#gridtext-title"><span class="header-section-number">10.3.1</span> Titles</a></li>
<li><a class="nav-link" href="#gridtext-dimnames"><span class="header-section-number">10.3.2</span> Row/column names</a></li>
<li><a class="nav-link" href="#gridtext-annotations"><span class="header-section-number">10.3.3</span> Annotation labels</a></li>
<li><a class="nav-link" href="#gridtext-anno-text"><span class="header-section-number">10.3.4</span> Text annotation</a></li>
<li><a class="nav-link" href="#gridtext-legends"><span class="header-section-number">10.3.5</span> Legend</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/jokergoo/ComplexHeatmap/blob/master/10-integrate-with-other-packages.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/jokergoo/ComplexHeatmap/edit/master/10-integrate-with-other-packages.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>ComplexHeatmap Complete Reference</strong>" was written by Zuguang Gu. It was last built on last revised on 2022-07-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Heatmap Decoration | ComplexHeatmap Complete Reference</title>
<meta name="author" content="Zuguang Gu">
<meta name="description" content="The plotting region for each heatmap component is still kept after the heatmaps are made, so it is possible to go back to the original places to add more graphics there. First let’s generate a...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="Chapter 6 Heatmap Decoration | ComplexHeatmap Complete Reference">
<meta property="og:type" content="book">
<meta property="og:url" content="https://jokergoo.github.io/ComplexHeatmap-reference/book/heatmap-decoration.html">
<meta property="og:image" content="https://jokergoo.github.io/ComplexHeatmap-reference/book/complexheatmap-cover.jpg">
<meta property="og:description" content="The plotting region for each heatmap component is still kept after the heatmaps are made, so it is possible to go back to the original places to add more graphics there. First let’s generate a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 6 Heatmap Decoration | ComplexHeatmap Complete Reference">
<meta name="twitter:description" content="The plotting region for each heatmap component is still kept after the heatmaps are made, so it is possible to go back to the original places to add more graphics there. First let’s generate a...">
<meta name="twitter:image" content="https://jokergoo.github.io/ComplexHeatmap-reference/book/complexheatmap-cover.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><style>
    #content {
    	font-size: 0.95rem;
    }
    </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">ComplexHeatmap Complete Reference</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="a-single-heatmap.html"><span class="header-section-number">2</span> A Single Heatmap</a></li>
<li><a class="" href="heatmap-annotations.html"><span class="header-section-number">3</span> Heatmap Annotations</a></li>
<li><a class="" href="a-list-of-heatmaps.html"><span class="header-section-number">4</span> A List of Heatmaps</a></li>
<li><a class="" href="legends.html"><span class="header-section-number">5</span> Legends</a></li>
<li><a class="active" href="heatmap-decoration.html"><span class="header-section-number">6</span> Heatmap Decoration</a></li>
<li><a class="" href="oncoprint.html"><span class="header-section-number">7</span> OncoPrint</a></li>
<li><a class="" href="upset-plot.html"><span class="header-section-number">8</span> UpSet plot</a></li>
<li><a class="" href="interactive.html"><span class="header-section-number">9</span> Interactive ComplexHeatmap</a></li>
<li><a class="" href="integrate-with-other-packages.html"><span class="header-section-number">10</span> Integrate with other packages</a></li>
<li><a class="" href="other-high-level-plots.html"><span class="header-section-number">11</span> Other High-level Plots</a></li>
<li><a class="" href="three-d-heatmap.html"><span class="header-section-number">12</span> Three-dimensional ComplexHeatmap</a></li>
<li><a class="" href="genome-level-heatmap.html"><span class="header-section-number">13</span> Genome-level heatmap</a></li>
<li><a class="" href="more-examples.html"><span class="header-section-number">14</span> More Examples</a></li>
<li><a class="" href="other-tricks.html"><span class="header-section-number">15</span> Other Tricks</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jokergoo/ComplexHeatmap">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="heatmap-decoration" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Heatmap Decoration<a class="anchor" aria-label="anchor" href="#heatmap-decoration"><i class="fas fa-link"></i></a>
</h1>
<p>The plotting region for each heatmap component is still kept after the
heatmaps are made, so it is possible to go back to the original places to add
more graphics there. First let’s generate a figure that almost contains all
types of heatmap components. <code>list_components()</code> lists the names of the
heatmap/annotation components (or the name of the viewport).</p>
<div class="sourceCode" id="cb514"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">mat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fl">8</span>, <span class="fl">10</span><span class="op">)</span>
<span class="va">mat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">mat</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">40</span>, <span class="op">-</span><span class="fl">2</span><span class="op">)</span>, <span class="fl">4</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>

<span class="va">ha_column1</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>points <span class="op">=</span> <span class="fu">anno_points</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>, 
    annotation_name_side <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span>
<span class="va">ht1</span> <span class="op">=</span> <span class="fu">Heatmap</span><span class="op">(</span><span class="va">mat</span>, name <span class="op">=</span> <span class="st">"ht1"</span>, km <span class="op">=</span> <span class="fl">2</span>, column_title <span class="op">=</span> <span class="st">"Heatmap 1"</span>, 
    top_annotation <span class="op">=</span> <span class="va">ha_column1</span>, row_names_side <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span>

<span class="va">ha_column2</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span> <span class="op">=</span> <span class="st">"red"</span>, <span class="st">"b"</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ht2</span> <span class="op">=</span> <span class="fu">Heatmap</span><span class="op">(</span><span class="va">mat</span>, name <span class="op">=</span> <span class="st">"ht2"</span>, row_title <span class="op">=</span> <span class="st">"Heatmap 2"</span>, column_title <span class="op">=</span> <span class="st">"Heatmap 2"</span>,
    bottom_annotation <span class="op">=</span> <span class="va">ha_column2</span>, column_km <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="va">ht_list</span> <span class="op">=</span> <span class="va">ht1</span> <span class="op">+</span> <span class="va">ht2</span> <span class="op">+</span> 
    <span class="fu">rowAnnotation</span><span class="op">(</span>bar <span class="op">=</span> <span class="fu">anno_barplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span>, width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">ht_list</span>, row_title <span class="op">=</span> <span class="st">"Heatmap list"</span>, column_title <span class="op">=</span> <span class="st">"Heatmap list"</span><span class="op">)</span>
<span class="fu">list_components</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "ROOT"                           "global"                        
##  [3] "global_layout"                  "global-heatmaplist"            
##  [5] "main_heatmap_list"              "heatmap_ht1"                   
##  [7] "ht1_heatmap_body_wrap"          "ht1_heatmap_body_1_1"          
##  [9] "ht1_heatmap_body_2_1"           "ht1_column_title_1"            
## [11] "ht1_row_title_1"                "ht1_row_title_2"               
## [13] "ht1_dend_row_1"                 "ht1_dend_row_2"                
## [15] "ht1_dend_column_1"              "ht1_row_names_1"               
## [17] "ht1_row_names_2"                "ht1_column_names_1"            
## [19] "annotation_points_1"            "heatmap_ht2"                   
## [21] "ht2_heatmap_body_wrap"          "ht2_heatmap_body_1_1"          
## [23] "ht2_heatmap_body_1_2"           "ht2_heatmap_body_2_1"          
## [25] "ht2_heatmap_body_2_2"           "ht2_column_title_1"            
## [27] "ht2_dend_column_1"              "ht2_dend_column_2"             
## [29] "ht2_column_names_1"             "ht2_column_names_2"            
## [31] "annotation_type_1"              "annotation_type_2"             
## [33] "heatmap_heatmap_annotation_2"   "annotation_bar_1"              
## [35] "annotation_bar_2"               "global-column_title_top"       
## [37] "global_column_title"            "global-row_title_left"         
## [39] "global_row_title"               "global-heatmap_legend_right"   
## [41] "heatmap_legend"                 "global-annotation_legend_right"
## [43] "annotation_legend"</code></pre>
<div class="inline-figure"><img src="06-heatmap_decoration_files/figure-html/access_components-1.png" width="960" style="display: block; margin: auto;"></div>
<p>Basically the red regions in above plot can be revisited by <code>decorate_*()</code>
functions.</p>
<div id="decoration-functions" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Decoration functions<a class="anchor" aria-label="anchor" href="#decoration-functions"><i class="fas fa-link"></i></a>
</h2>
<p>Since you can get the viewport name by <code>list_components()</code>, actually you can
directly go to the viewport by <code>seekViewport()</code>. To get rid of the complicated
viewport names, the <code>decorate_*()</code> functions provide a more friendly way to do
it.</p>
<p>There are following decoration functions in <strong>ComplexHeatmap</strong> package:</p>
<ul>
<li><code>decorate_heatmap_body()</code></li>
<li><code>decorate_annotation()</code></li>
<li><code>decorate_dend()</code></li>
<li><code>decorate_title()</code></li>
<li><code>decorate_dimnames()</code></li>
<li>
<code>decorate_row_names()</code>, identical to <code>decorate_dimnames(..., which = "row")</code>.</li>
<li>
<code>decorate_column_names()</code>, identical to <code>decorate_dimnames(..., which = "column")</code>.</li>
<li>
<code>decorate_row_dend()</code>, identical to <code>decorate_dend(..., which = "row")</code>.</li>
<li>
<code>decorate_column_dend()</code>, identical to <code>decorate_dend(..., which = "column")</code>.</li>
<li>
<code>decorate_row_title()</code>, identical to <code>decorate_title(..., which = "row")</code>.</li>
<li>
<code>decorate_column_title()</code>, identical to <code>decorate_title(..., which = "column")</code>.</li>
</ul>
<p>Among them, <code>decorate_heatmap_body()</code> and <code>decorate_annotation()</code> are more often used.</p>
<p>For all these functions, they need a heatmap or annotation name, index for the
row/column slices if the heatmap is split and a code block which defines how
to add graphics. Check following example.</p>
<div class="sourceCode" id="cb516"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ht_list</span> <span class="op">=</span> <span class="fu">draw</span><span class="op">(</span><span class="va">ht_list</span>, row_title <span class="op">=</span> <span class="st">"Heatmap list"</span>, column_title <span class="op">=</span> <span class="st">"Heatmap list"</span>, 
    heatmap_legend_side <span class="op">=</span> <span class="st">"right"</span>, annotation_legend_side <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span>

<span class="fu">decorate_heatmap_body</span><span class="op">(</span><span class="st">"ht1"</span>, <span class="op">{</span>
    <span class="fu">grid.text</span><span class="op">(</span><span class="st">"outlier"</span>, <span class="fl">1.5</span><span class="op">/</span><span class="fl">10</span>, <span class="fl">2.5</span><span class="op">/</span><span class="fl">4</span>, default.units <span class="op">=</span> <span class="st">"npc"</span><span class="op">)</span>
    <span class="fu">grid.lines</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>, slice <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="fu">decorate_column_dend</span><span class="op">(</span><span class="st">"ht1"</span>, <span class="op">{</span>
    <span class="va">tree</span> <span class="op">=</span> <span class="fu">column_dend</span><span class="op">(</span><span class="va">ht_list</span><span class="op">)</span><span class="op">$</span><span class="va">ht1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
    <span class="va">ind</span> <span class="op">=</span> <span class="fu"><a href="http://talgalili.github.io/dendextend/reference/cutree-methods.html">cutree</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/as.hclust.html">as.hclust</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/order.dendrogram.html">order.dendrogram</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span><span class="op">]</span>

    <span class="va">first_index</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">l</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">l</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
    <span class="va">last_index</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">l</span><span class="op">)</span> <span class="op">{</span> <span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">l</span><span class="op">)</span>; <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span> <span class="op">}</span>
    <span class="va">x1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">first_index</span><span class="op">(</span><span class="va">ind</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu">first_index</span><span class="op">(</span><span class="va">ind</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>
    <span class="va">x2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">last_index</span><span class="op">(</span><span class="va">ind</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu">last_index</span><span class="op">(</span><span class="va">ind</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
    <span class="fu">grid.rect</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ind</span><span class="op">)</span>, width <span class="op">=</span> <span class="op">(</span><span class="va">x2</span> <span class="op">-</span> <span class="va">x1</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ind</span><span class="op">)</span>, just <span class="op">=</span> <span class="st">"left"</span>,
        default.units <span class="op">=</span> <span class="st">"npc"</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#FF000040"</span>, <span class="st">"#00FF0040"</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="fu">decorate_row_names</span><span class="op">(</span><span class="st">"ht1"</span>, <span class="op">{</span>
    <span class="fu">grid.rect</span><span class="op">(</span>gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#FF000040"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>, slice <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="fu">decorate_row_title</span><span class="op">(</span><span class="st">"ht1"</span>, <span class="op">{</span>
    <span class="fu">grid.rect</span><span class="op">(</span>gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#00FF0040"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>, slice <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="fu">decorate_annotation</span><span class="op">(</span><span class="st">"points"</span>, <span class="op">{</span>
    <span class="fu">grid.lines</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu">unit</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"native"</span><span class="op">)</span>, gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="06-heatmap_decoration_files/figure-html/components-1.png" width="960" style="display: block; margin: auto;"></div>
<p>For annotations which are created by <code>anno_points()</code>, <code>anno_barplot()</code> and
<code>anno_boxplot()</code>, “native” unit can be used in the decoration code.</p>
</div>
<div id="decoration-examples" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Examples<a class="anchor" aria-label="anchor" href="#decoration-examples"><i class="fas fa-link"></i></a>
</h2>
<div id="barplot-for-single-column-heatmap" class="section level3" number="6.2.1">
<h3>
<span class="header-section-number">6.2.1</span> Barplot for single-column heatmap<a class="anchor" aria-label="anchor" href="#barplot-for-single-column-heatmap"><i class="fas fa-link"></i></a>
</h3>
<p>In Section <a href="heatmap-annotations.html#summary-annotation">3.20</a>, we introduced adding barplots as
annotations for single-column heatmap. In that case the heatmap contains
discrete values where the barplots show the frequency of each level. In
following example, we show another scenario of using barplot as annotation but
for a continuous heatmap.</p>
<p>Imagining we are analyzing a set of genomic regions (e.g. differentially
methylated regions, DMRs) and we have a single-column heatmap which shows the
overlap to e.g. genes (measured by the fraction of a DMR covered by genes,
value between 0 and 1, e.g. a value of 0.5 means 50% of this DMR overlaps to
the genes). If we denote the width of DMRs as <span class="math inline">\(w\)</span> and the fraction as <span class="math inline">\(p\)</span>, on
top of the fraction heatmap, we want to add barplots to show, on average, how
much of the DMRs are covered by genes. In this case, we need to calcualte the
mean fraction weighted by the width of DMRs (<span class="math inline">\(\sum{(w \cdot p)}/\sum{w}\)</span>).</p>
<p>In following code, we randomly generated a fraction vector and split it into
two groups. We first use <code>anno_empty()</code> to allocate empty plotting region on
top of the heatmap and later we use <code>decorate_annotation()</code> to add the
barplots into it.</p>
<div class="sourceCode" id="cb517"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/circlize">circlize</a></span><span class="op">)</span>
<span class="co"># DMRs</span>
<span class="va">bed</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/generateRandomBed.html">generateRandomBed</a></span><span class="op">(</span>nr <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>
<span class="co"># fractions</span>
<span class="va">frac</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">400</span>, min <span class="op">=</span> <span class="fl">0.4</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">bed</span><span class="op">)</span> <span class="op">-</span> <span class="fl">400</span>, min <span class="op">=</span> <span class="fl">0.2</span>, max <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span>
<span class="va">col_fun</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html">colorRamp2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"orange"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># two groups</span>
<span class="va">split</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"group1"</span>, <span class="fl">400</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"group2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">bed</span><span class="op">)</span> <span class="op">-</span> <span class="fl">400</span><span class="op">)</span><span class="op">)</span>
<span class="co"># draw the fraction heatmap with an empty annotation</span>
<span class="va">ht</span> <span class="op">=</span> <span class="fu">Heatmap</span><span class="op">(</span><span class="va">frac</span>, name <span class="op">=</span> <span class="st">"fraction"</span>, col <span class="op">=</span> <span class="va">col_fun</span>, width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"cm"</span><span class="op">)</span>,
    top_annotation <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>barplot <span class="op">=</span> <span class="fu">anno_empty</span><span class="op">(</span>height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ht</span> <span class="op">=</span> <span class="fu">draw</span><span class="op">(</span><span class="va">ht</span>, row_split <span class="op">=</span> <span class="va">split</span><span class="op">)</span>
<span class="co"># get the row indices in the two row-groups</span>
<span class="va">ro</span> <span class="op">=</span> <span class="fu">row_order</span><span class="op">(</span><span class="va">ht</span><span class="op">)</span>
<span class="va">w</span> <span class="op">=</span> <span class="va">bed</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">bed</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>
<span class="co"># the mean weighted fraction in the two groups</span>
<span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">ro</span>, <span class="kw">function</span><span class="op">(</span><span class="va">index</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="va">index</span><span class="op">]</span><span class="op">*</span><span class="va">frac</span><span class="op">[</span><span class="va">index</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="va">index</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co"># add two bars of `p`</span>
<span class="fu">decorate_annotation</span><span class="op">(</span><span class="st">"barplot"</span>, <span class="op">{</span>
    <span class="fu">pushViewport</span><span class="op">(</span><span class="fu">viewport</span><span class="op">(</span>xscale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">2.5</span><span class="op">)</span>, yscale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">*</span><span class="fl">1.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="fu">grid.rect</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, y <span class="op">=</span> <span class="fl">0</span>, width <span class="op">=</span> <span class="fl">0.8</span>, height <span class="op">=</span> <span class="va">p</span>, just <span class="op">=</span> <span class="st">"bottom"</span>,
        gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span>, default.units <span class="op">=</span> <span class="st">"native"</span><span class="op">)</span>
    <span class="fu">grid.yaxis</span><span class="op">(</span><span class="op">)</span>
    <span class="fu">grid.text</span><span class="op">(</span><span class="st">"mean fraction"</span>, x <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="st">"cm"</span><span class="op">)</span>,rot <span class="op">=</span> <span class="fl">90</span>, just <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span>
    <span class="fu">popViewport</span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="06-heatmap_decoration_files/figure-html/unnamed-chunk-1-1.png" width="672" style="display: block; margin: auto;"></div>
</div>
<div id="add-titles-for-row-annotations" class="section level3" number="6.2.2">
<h3>
<span class="header-section-number">6.2.2</span> Add titles for row annotations<a class="anchor" aria-label="anchor" href="#add-titles-for-row-annotations"><i class="fas fa-link"></i></a>
</h3>
<p>Row annotations can be concatenated to the heatmap list. Sometimes we need a
title for the row annotation. It is easy to implement it by decorations.</p>
<div class="sourceCode" id="cb518"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ht_list</span> <span class="op">=</span> <span class="fu">Heatmap</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"mat"</span>, show_column_dend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">rowAnnotation</span><span class="op">(</span>foo <span class="op">=</span> <span class="fu">anno_barplot</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">rowAnnotation</span><span class="op">(</span>bar <span class="op">=</span> <span class="fu">anno_boxplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">4</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">draw</span><span class="op">(</span><span class="va">ht_list</span>, padding <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span> <span class="co"># add space for titles</span>
<span class="fu">decorate_annotation</span><span class="op">(</span><span class="st">"foo"</span>, <span class="op">{</span> 
    <span class="fu">grid.text</span><span class="op">(</span><span class="st">"title for barplot"</span>, y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>, just <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> 
<span class="op">}</span><span class="op">)</span>
<span class="fu">decorate_annotation</span><span class="op">(</span><span class="st">"bar"</span>, <span class="op">{</span> 
    <span class="fu">grid.text</span><span class="op">(</span><span class="st">"title for boxplot"</span>, y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>, just <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> 
<span class="op">}</span><span class="op">)</span>
<span class="fu">decorate_heatmap_body</span><span class="op">(</span><span class="st">"mat"</span>, <span class="op">{</span>
    <span class="fu">grid.text</span><span class="op">(</span><span class="st">"title for the heatmap"</span>, y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>, just <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="06-heatmap_decoration_files/figure-html/unnamed-chunk-2-1.png" width="768" style="display: block; margin: auto;"></div>
<p>This is basically the way we use in Section <a href="other-high-level-plots.html#stacked-summary-plot">11.2</a>.</p>
</div>
<div id="other-possible-use-of-decorations" class="section level3" number="6.2.3">
<h3>
<span class="header-section-number">6.2.3</span> Other possible use of decorations<a class="anchor" aria-label="anchor" href="#other-possible-use-of-decorations"><i class="fas fa-link"></i></a>
</h3>
<p>There are some other examples where decoration is helpful:</p>
<ul>
<li>The quantile lines are added in <code>densityHeatmap()</code>, Section <a href="other-high-level-plots.html#density-heatmap">11.1</a>.</li>
<li>Heatmap annotations are grouped by lines, Section <a href="more-examples.html#visualize-methylation-profile-with-complex-annotations">14.5</a>.</li>
<li>Texts are added to heatmaps, Section <a href="more-examples.html#the-measles-vaccine-heatmap">14.2</a>.</li>
</ul>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="legends.html"><span class="header-section-number">5</span> Legends</a></div>
<div class="next"><a href="oncoprint.html"><span class="header-section-number">7</span> OncoPrint</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#heatmap-decoration"><span class="header-section-number">6</span> Heatmap Decoration</a></li>
<li><a class="nav-link" href="#decoration-functions"><span class="header-section-number">6.1</span> Decoration functions</a></li>
<li>
<a class="nav-link" href="#decoration-examples"><span class="header-section-number">6.2</span> Examples</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#barplot-for-single-column-heatmap"><span class="header-section-number">6.2.1</span> Barplot for single-column heatmap</a></li>
<li><a class="nav-link" href="#add-titles-for-row-annotations"><span class="header-section-number">6.2.2</span> Add titles for row annotations</a></li>
<li><a class="nav-link" href="#other-possible-use-of-decorations"><span class="header-section-number">6.2.3</span> Other possible use of decorations</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/jokergoo/ComplexHeatmap/blob/master/06-heatmap_decoration.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/jokergoo/ComplexHeatmap/edit/master/06-heatmap_decoration.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>ComplexHeatmap Complete Reference</strong>" was written by Zuguang Gu. It was last built on last revised on 2022-07-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
